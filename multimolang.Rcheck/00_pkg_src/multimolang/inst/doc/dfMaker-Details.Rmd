---
title: "dfMaker-Details"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{dfMaker-Details}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = FALSE}
library(multimolang)
```

## Introduction

The `multimolang` package provides tools for analyzing multimodal language data. In this vignette, we will describe in detail the `dfMaker` function, which processes and organizes keypoints data generated by OpenPose.

## Using `dfMaker`

The `dfMaker` function takes as input a folder containing JSON files generated by OpenPose and compiles them into a structured data frame suitable for further analysis.

### Usage Example

```{r example_usage, eval = FALSE}
# Define input parameters
input_folder <- "path/to/json/files"
config_path <- "path/to/config.json"  # Optional if using NewsScape data
output_file <- "processed_data.csv"
output_path <- "path/to/output"

# Call the dfMaker function
df <- dfMaker(
  input.folder = input_folder,
  config.path = config_path,
  output.file = output_file,
  output.path = output_path,
  no_save = FALSE,
  fast_scaling = TRUE,
  transformation_coords = c(1, 1, 5, 5)
)

# View the first few rows of the resulting data frame
head(df)
```

### Parameter Explanation

- **`input.folder`**: Path to the folder containing OpenPose JSON files.
- **`config.path`**: Path to the configuration file for extracting metadata (optional).
- **`output.file`**: Name of the output file.
- **`output.path`**: Directory where the output file will be saved.
- **`no_save`**: If `TRUE`, does not save the result to a file.
- **`fast_scaling`**: If `TRUE`, uses fast scaling for transformation.
- **`transformation_coords`**: Numeric vector of length 4 specifying the transformation coordinates.

## Additional Details

The function depends on the **`arrow`** package for efficient reading and writing of JSON and Parquet files. Make sure you have it installed:

```{r install_arrow, eval = FALSE}
install.packages("arrow")
```

### Error Handling

- If the JSON files do not have the expected format or are empty, the function will skip them and display a message.
- If `output.file` is `NULL` and multiple unique `id` values are found, the function will generate an error requesting an explicit file name.

## Notes on NewsScape Data

If you are working with data from the **UCLA NewsScape** archive, you can use the `config.path` parameter to specify how to extract metadata from the filenames.

**Example Configuration File (`config.json`):**

```json
{
    "extract_datetime": true,
    "extract_time": true,
    "extract_exp_search": true,
    "extract_country_code": true,
    "extract_network_code": true,
    "extract_program_name": true,
    "extract_time_range": true,
    "timezone": "America/Los_Angeles"
}
```

## Full Example

```{r full_example, eval = FALSE}
# Define paths to example data included with the package
input_folder <- system.file("extdata/example_videos/output1", package = "multimolang")
output_file <- "processed_data.csv"
output_path <- tempdir()  # Use a temporary directory for writing output during examples

# Run dfMaker
df <- dfMaker(
  input.folder = input_folder,
  output.file = output_file,
  output.path = output_path,
  no_save = FALSE,
  fast_scaling = TRUE,
  transformation_coords = c(1, 1, 5, 5)
)

# View the first few rows of the resulting data frame
head(df)

```

## Conclusion

The `dfMaker` function simplifies the processing of large volumes of keypoints data, enabling easier integration into data analysis and machine learning workflows.

## References

- **UCLA NewsScape**: [https://bigdatasocialscience.ucla.edu/newsscape/](https://bigdatasocialscience.ucla.edu/newsscape/)
- **OpenPose**: [https://github.com/CMU-Perceptual-Computing-Lab/openpose](https://github.com/CMU-Perceptual-Computing-Lab/openpose)
- **arrow package**: [https://cran.r-project.org/package=arrow](https://cran.r-project.org/package=arrow)
